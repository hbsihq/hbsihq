{
  "posts": [
    {
      "content": "## 一 、 准备环境\n\n- 硬件配置: 2个CPU核心, 4G 内存, 50G 硬盘（最低）\n- 操作系统: Linux 发行版 x86_64\n- Python = 3.6.x\n- Mysql Server ≥ 5.7\n- Redis\n\n### 安装工具\n\n更换yum源\n\n```shell\nwget -O /etc/yum.repos.d/CentOS-Base.repo https://mirrors.aliyun.com/repo/Centos-7.repo && sed -i -e '/mirrors.cloud.aliyuncs.com/d' -e '/mirrors.aliyuncs.com/d' /etc/yum.repos.d/CentOS-Base.repo && yum clean all\n```\n\n安装 epel-release 和更换源\n\n```shell\nyum install  epel-release\nwget -O /etc/yum.repos.d/epel.repo https://mirrors.aliyun.com/repo/epel-7.repo\n```\n\n安装 其他工具\n\n```shell\n##安装 wget\nyum install -y wget \n ##安装 git\nyum install -y git\n ## 安装 gcc\n yum install -y gcc\n```\n\n\n\n### 1.安装mysql\n\n```shell\n#1.添加mysq57源\nyum -y localinstall http://mirrors.ustc.edu.cn/mysql-repo/mysql57-community-release-el7.rpm\n#2。安装mysql-server\nyum install mysql-community-server mysql-community-devel -y\n#3.启动\n[root@localhost ~]# systemctl enable mysqld\n[root@localhost ~]# systemctl start mysqld\n##修改root密码\n---查看root默认密码---\n[root@localhost ~]# grep 'password' /var/log/mysqld.log \n---修改----\n[root@localhost ~]# mysql -uroot -p'Jj(dkdwVI5ba'\nmysql> alter user 'root'@'localhost' identified by 'Com.123456';\n##-----为jumpserver创建数据库以及用户\nmysql> create database jumpserver default charset 'utf8' collate 'utf8_bin';\nmysql> grant all on jumpserver.* to 'jumpserver'@'127.0.0.1' identified by 'Com.123456';\nmysql> grant all on jumpserver.* to 'jumpserver'@'%' identified by 'Com.123456';\nmysql> flush privileges;\n```\n\n### 2.搭建Python环境\n\n```shell\n##--安装\nyum install python36-devel python36 -y\n\n--构建虚拟环境--\n[root@localhost ~]# python3.6 -m venv /opt/py3\n--进入环境--\n[root@localhost ~]# source /opt/py3/bin/activate\n\n```\n\n### 3.获取jumpserver的项目代码\n\n```shell\ncd /opt && \\\nwget https://github.com/jumpserver/jumpserver/releases/download/v2.5.3/jumpserver-v2.5.3.tar.gz\n--解压--\ntar zxvf jumpserver-v2.5.3.tar.gz\n--重命名--\n mv jumpserver-v2.5.3 jumpserver\n ###wget下载慢可用迅雷下载再上传\n```\n\n### 4.安装编译环境\n\n```shell\n##安装编译环境\n/opt/jumpserver/requirements/\nrpm_requirements.txt #rpm 环境\nrequirements.txt #python环境\n-------安装--------\nyum install -y $(cat rpm_requirements.txt)\npip install -r requirements.txt\n##若无法下载就修改pip源 \nvi ~/.pip/pip.conf\n---pip源---\n[global]\nindex-url = https://mirrors.aliyun.com/pypi/simple/\n\n[install]\ntrusted-host=mirrors.aliyun.com\n##也可用以下命令直接安装\npip install -r requirements.txt -i https://mirrors.aliyun.com/pypi/simple/\n\n\n```\n\n### 5.修改配置文件\n\n```shell\n(py3) [root@localhost jumpserver]# cp config_example.yml config.yml\n(py3) [root@localhost jumpserver]# vi config.yml\n# $ cat /dev/urandom | tr -dc A-Za-z0-9 | head -c 49;echo\nSECRET_KEY: nBAHxvmIK7QDvDNk3R2Gqpa32t4Jd7SECD8a5MZzskF6jiKP9\n\n# SECURITY WARNING: keep the bootstrap token used in production secret!\n# 预共享Token coco和guacamole用来注册服务账号，不在使用原来的注册接受机制\nBOOTSTRAP_TOKEN: Htry5PvLiG85OhxJ8Cli8K23eZoX1KwWN9Jbb7RkBO8smOuY9\n\n# 使用Mysql作为数据库\nDB_ENGINE: mysql\nDB_HOST: 127.0.0.1\nDB_PORT: 3306\nDB_USER: jumpserver\nDB_PASSWORD: Com.123456\nDB_NAME: jumpserver\n\n```\n\n## 6.启动jumpserver\n\n\n\n```shell\n(py3) [root@localhost jumpserver]# ./jms start all -d\n##出现如下信息成功启动\ngunicorn is running: 3776\nflower is running: 3787\ndaphne is running: 3791\ncelery_ansible is running: 3795\ncelery_default is running: 3810\ncelery_node_tree is running: 3816\ncelery_check_asset_perm_expired is running: 3828\ncelery_heavy_tasks is running: 3832\nbeat is running: 3837\n\n```\n\n## 7.部署koko、下载lina和luna和Nigix整合\n\n```shell\n##下载koko--建议使用迅雷下载要不然慢\nwget https://github.com/jumpserver/koko/releases/download/v2.5.3/koko-v2.5.3-linux-amd64.tar.gz\n##解压并改名\ntar -xf koko-v2.5.3-linux-amd64.tar.gz\nmv koko-v2.5.3-linux-amd64/ koko\n\n##将koko/下的kubectl 移动到/usr/local/bin/\n(py3) [root@localhost opt]# cd koko/\n(py3) [root@localhost koko]# ls\nconfig_example.yml  init-kubectl.sh  koko  kubectl  locale  static  templates\n(py3) [root@localhost koko]# mv kubectl /usr/local/bin/\n\n##下载jumpserver 的  kubectl 改成可执行放到/usr/local/bin/ 改名为 rawkubectl\nwget https://download.jumpserver.org/public/kubectl.tar.gz\ntar -xf kubectl.tar.gz\nchmod 755 kubectl\nmv kubectl /usr/local/bin/rawkubectl\n\n##--- 拷贝一份配置文件\n(py3) [root@localhost koko]# cp config_example.yml config.yml\n(py3) [root@localhost koko]# vi config.yml \n\n# 请和jumpserver 配置文件中保持一致，注册完成后可以删除\nBOOTSTRAP_TOKEN: Htry5PvLiG85OhxJ8Cli8K23eZoX1KwWN9Jbb7RkBO8smOuY9\n\n##执行kok\n./koko\n\n\n## 安装nginx\nyum install nginx\n\n##下载lina组件\ncd /opt\nwget https://github.com/jumpserver/lina/releases/download/v2.5.3/lina-v2.5.3.tar.gz\n(py3) [root@localhost opt]# tar -xf lina-v2.5.3.tar.gz\n(py3) [root@localhost opt]# mv lina-v2.5.3 lina\n(py3) [root@localhost opt]# chown -R nginx:nginx lina\n\n##下载Luna\ncd /opt\nwget https://github.com/jumpserver/luna/releases/download/v2.5.3/luna-v2.5.3.tar.gz\ntar -xf luna-v2.5.3.tar.gz\nmv luna-v2.5.3 luna\nchown -R nginx:nginx luna \n\n##配置整合 \n#nginx修改配置文件\n#如下\n```\n\n```shell\nserver {\n    listen 80;\n\n    client_max_body_size 100m;  # 录像及文件上传大小限制\n\n    location /ui/ {\n        try_files $uri / /index.html;\n        alias /opt/lina/;\n    }\n\n    location /luna/ {\n        try_files $uri / /index.html;\n        alias /opt/luna/;  # luna 路径, 如果修改安装目录, 此处需要修改\n    }\n\n    location /media/ {\n        add_header Content-Encoding gzip;\n        root /opt/jumpserver/data/;  # 录像位置, 如果修改安装目录, 此处需要修改\n    }\n\n    location /static/ {\n        root /opt/jumpserver/data/;  # 静态资源, 如果修改安装目录, 此处需要修改\n    }\n\n    location /koko/ {\n        proxy_pass       http://localhost:5000;\n        proxy_buffering off;\n        proxy_http_version 1.1;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection \"upgrade\";\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header Host $host;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        access_log off;\n    }\n\n    location /guacamole/ {\n        proxy_pass       http://localhost:8081/;\n        proxy_buffering off;\n        proxy_http_version 1.1;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection $http_connection;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header Host $host;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        access_log off;\n    }\n\n    location /ws/ {\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header Host $host;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_pass http://localhost:8070;\n        proxy_http_version 1.1;\n        proxy_buffering off;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection \"upgrade\";\n    }\n\n    location /api/ {\n        proxy_pass http://localhost:8080;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header Host $host;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n    }\n\n    location /core/ {\n        proxy_pass http://localhost:8080;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header Host $host;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n    }\n\n    location / {\n        rewrite ^/(.*)$ /ui/$1 last;\n    }\n}\n```\n\n```shell\n##启动nginx\n(py3) [root@localhost opt]# systemctl enable nginx\n(py3) [root@localhost opt]# systemctl start nginx\n\n#nginx -t\n#nginx -s reload\n\n```\n\n\n\n----------------------------\n\n# web页面\n\n## 1.创建jumpserver用户\n\n- 用于连接jumpserver 识别用户\n\n- jump用户为实际人员使用的账户\n\n- 通过用户登录jumpserver 再根据授权的资产使用系统用户登录系统\n\n  ![](http://changetm.oss-cn-beijing.aliyuncs.com/Course/Attachment/d218bb02-9018-4783-9638-0cc1ea432835.png)\n\n  \n\n## 2.创建管理用户\n\n- 管理用户是资产（被控服务器）上的 root，或拥有 NOPASSWD: ALL sudo 权限的用户， \n- JumpServer 使用该用户来 `推送系统用户`、`获取资产硬件信息` 等。\n\n![](http://changetm.oss-cn-beijing.aliyuncs.com/Course/Attachment/1cc04ca8-c0a7-430c-9bba-04aa4031011c.png)\n\n## 创建系统用户\n\n- 系统用户是 JumpServer 跳转登录资产时使用的用户，可以理解为登录资产用户\n\n```\n开启自动推送\n- 如果支持可以自动推送不支持请手动配置\n设置密码\n- 配置当前系统用户的密码\n```\n\n## 创建资源和授权用户\n\n- 添加资源\n- 为用户和用户组授权资源\n\n![](http://changetm.oss-cn-beijing.aliyuncs.com/Course/Attachment/be89cd2a-f0f7-4870-998f-52898cbf7a51.png)\n\n![](http://changetm.oss-cn-beijing.aliyuncs.com/Course/Attachment/fcf6543e-dec2-45a4-a810-8b04dd959037.png)\n\n## 成功连接\n\n- web连接\n\n![](http://changetm.oss-cn-beijing.aliyuncs.com/Course/Attachment/c4303339-a721-47b1-bb3e-4dcabaa2ecf0.png)\n\n- xshel 连接jump\n\n  ![](http://changetm.oss-cn-beijing.aliyuncs.com/Course/Attachment/a8a1eea3-e9ad-4119-9eb0-b5f227d87642.png)\n\n## P查看资产\n\n![](http://changetm.oss-cn-beijing.aliyuncs.com/Course/Attachment/baff7d49-a5fc-4345-80b0-74630869c307.png)\n\n## 输入数字进行连接\n\n![](http://changetm.oss-cn-beijing.aliyuncs.com/Course/Attachment/20409016-ad09-46d6-aa56-c48e88c8a790.png)\n\n\n\n备注：\n如何忘记了管理用户admin的密码，可以这样来修改：\n[root@jumpserver ~]# cd /opt/jumpserver/apps/\n(py3) [root@jumpserver apps]# python change password admin\n也可以创建新管理用户：\n(py3) [root@jumpserver apps]# python manage.py createsuperuser --username=admin2 --email=2345@qq.com",
      "data": {
        "title": "jumpserver安装和使用详细文档",
        "date": "2020-12-13 22:37:57",
        "tags": [],
        "published": true,
        "hideInList": false,
        "feature": "/post-images/jumpserver-an-zhuang-he-shi-yong-xiang-xi-wen-dang.png"
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "jumpserver-an-zhuang-he-shi-yong-xiang-xi-wen-dang"
    }
  ],
  "tags": [],
  "menus": [
    {
      "link": "/",
      "name": "首页",
      "openType": "Internal"
    },
    {
      "link": "/archives",
      "name": "归档",
      "openType": "Internal"
    },
    {
      "link": "/tags",
      "name": "标签",
      "openType": "Internal"
    },
    {
      "link": "/post/about",
      "name": "关于",
      "openType": "Internal"
    }
  ]
}